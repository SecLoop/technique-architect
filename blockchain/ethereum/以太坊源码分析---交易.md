



流程图




### 一、概述
`go-ethereum版本为v1.9.6`   

交易流程主要分为以下步骤:  
1.创建交易：指定目标地址和交易金额，以及必需的gas/gasLimit  
2.交易签名：使用账户私钥对交易进行签名  
3.提交交易：验签交易，并将交易提交到交易缓冲池  
4.广播交易：通知以太坊虚拟机把交易信息广播给其他节点  
先上个交易流程图，然后在看具体的代码分析

![以太坊交易流程图-整体](https://github.com/jxu86/technique-architect/blob/master/file/以太坊交易流程图_整体.png)  
![以太坊交易流程图-具体](https://github.com/jxu86/technique-architect/blob/master/file/以太坊交易流程图_具体.png)

### 二、创建交易  
当用户通过JSON RPC发起sendTransaction请求时，最终调用internal/ethapi/api.go:SendTransaction方法:
```
// SendTransaction creates a transaction for the given argument, sign it and submit it to the
// transaction pool.
func (s *PublicTransactionPoolAPI) SendTransaction(ctx context.Context, args SendTxArgs) (common.Hash, error) {
	// Look up the wallet containing the requested signer
	account := accounts.Account{Address: args.From}

	wallet, err := s.b.AccountManager().Find(account)
	if err != nil {
		return common.Hash{}, err
	}

	if args.Nonce == nil {
		// Hold the addresse's mutex around signing to prevent concurrent assignment of
		// the same nonce to multiple accounts.
		s.nonceLock.LockAddr(args.From)
		defer s.nonceLock.UnlockAddr(args.From)
	}

	// Set some sanity defaults and terminate on failure
	if err := args.setDefaults(ctx, s.b); err != nil {
		return common.Hash{}, err
	}
	// Assemble the transaction and sign with the wallet
	tx := args.toTransaction()

	signed, err := wallet.SignTx(account, tx, s.b.ChainConfig().ChainID)
	if err != nil {
		return common.Hash{}, err
	}
	return SubmitTransaction(ctx, s.b, signed)
}
```

SendTxArgs类型的定义如下:
```
// SendTxArgs represents the arguments to sumbit a new transaction into the transaction pool.
type SendTxArgs struct {
	From     common.Address  `json:"from"`  //发送账户地址
	To       *common.Address `json:"to"`    //接收账户地址，如果是创建合约为nil
	Gas      *hexutil.Uint64 `json:"gas"`
	GasPrice *hexutil.Big    `json:"gasPrice"`
	Value    *hexutil.Big    `json:"value"`
	Nonce    *hexutil.Uint64 `json:"nonce"` //随账户交易次数自增的数字，一般会自动填充
	// We accept "data" and "input" for backwards-compatibility reasons. "input" is the
	// newer name and should be preferred by clients.
	Data  *hexutil.Bytes `json:"data"`      //和input的作用一样，为了向后兼容，推荐用input
	Input *hexutil.Bytes `json:"input"`     //交易的额外数据，如果是创建合约是合约的字节码，如果是调用合约，是合约方法和参数
}
```





### 三、交易签名


### 四、提交交易


### 五、广播交易




参考:  
[以太坊源码解析 - 交易源码分析](https://blog.csdn.net/luckydog612/article/details/80546989)

[以太坊交易源码分析](https://blog.csdn.net/TurkeyCock/article/details/80485391)